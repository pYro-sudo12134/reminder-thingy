<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
    <title>Voice Reminder - Логин</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 8px; margin-top: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .hidden { display: none; }
        .error { color: red; margin-top: 10px; }
        .success { color: green; margin-top: 10px; }
        .nav-links { margin-top: 20px; }
        .nav-links a {
            display: block;
            padding: 10px;
            background: #28a745;
            color: white;
            text-decoration: none;
            margin: 5px 0;
            text-align: center;
            border-radius: 4px;
        }
        .nav-links a:hover { background: #218838; }
    </style>
</head>
<body>
<div id="login-form">
    <h2>Voice Reminder - Login</h2>
    <div class="form-group">
        <label>Username:</label>
        <input type="text" id="username" value="admin">
    </div>
    <div class="form-group">
        <label>Password:</label>
        <input type="password" id="password" value="admin123">
    </div>
    <button onclick="login()">Login</button>
    <a href="/register.html">Регистрация</a>
    <div id="login-error" class="error hidden"></div>
</div>

<div id="app" class="hidden">
    <h2>Welcome, <span id="username-display"></span>!</h2>

    <div class="nav-links">
        <a href="/record.html">Запись голосового напоминания</a>
        <a href="/reminders.html">Мои напоминания</a>
        <a href="#" onclick="testApi()">Test API</a>
    </div>

    <button onclick="logout()" style="margin-top: 20px; background: #dc3545;">Logout</button>

    <div id="api-result" class="success" style="margin-top: 10px;"></div>
</div>

<script>
    checkAuth();

    async function checkAuth() {
        try {
            const response = await fetch('/api/auth/me');
            if (response.ok) {
                const data = await response.json();
                showApp(data.username);
            } else {
                showLoginForm();
            }
        } catch (error) {
            showLoginForm();
        }
    }

    async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const formData = new URLSearchParams();
        formData.append('username', username);
        formData.append('password', password);

        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formData
            });

            if (response.ok) {
                const data = await response.json();
                showApp(data.username);
            } else {
                document.getElementById('login-error').textContent = 'Login failed';
                document.getElementById('login-error').classList.remove('hidden');
            }
        } catch (error) {
            document.getElementById('login-error').textContent = 'Network error';
            document.getElementById('login-error').classList.remove('hidden');
        }
    }

    async function logout() {
        await fetch('/api/auth/logout', { method: 'POST' });
        showLoginForm();
    }

    async function testApi() {
        try {
            const response = await fetch('/api/test');
            if (response.ok) {
                const text = await response.text();
                document.getElementById('api-result').textContent = 'API Status: ' + text;
            } else {
                document.getElementById('api-result').textContent = 'API Error: ' + response.status;
            }
        } catch (error) {
            document.getElementById('api-result').textContent = 'Network error';
        }
    }

    function showApp(username) {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        document.getElementById('username-display').textContent = username;
        document.getElementById('login-error').classList.add('hidden');
    }

    function showLoginForm() {
        document.getElementById('login-form').classList.remove('hidden');
        document.getElementById('app').classList.add('hidden');
        document.getElementById('api-result').textContent = '';
    }
</script>
</body>
</html>