openapi: 3.0.1
info:
  title: Voice Reminder API
  description: |
    ## Intelligent Voice Reminder Assistant
  version: 2.0.0
  contact:
    name: Voice Reminder Team
    email: losik2006@gmail.com
  license:
    name: Proprietary

servers:
  - url: https://api.voicereminder.example.com/v1
    description: Production API
  - url: http://localhost:8090/api
    description: Local development
  - url: http://api.reminder.local/v1
    description: Docker Swarm internal

tags:
  - name: Reminders
    description: Voice reminder operations
    x-displayName: "Reminders"
  - name: Search
    description: Contextual search and autocomplete
    x-displayName: "Search"
  - name: Stats
    description: User statistics and analytics
    x-displayName: "Statistics"
  - name: Auth
    description: Authentication and password management
    x-displayName: "Authentication"
  - name: Health
    description: Service health checks
    x-displayName: "Health"
  - name: Metrics
    description: Prometheus metrics
    x-displayName: "Metrics"

paths:
  /auth/login:
    post:
      tags:
        - Auth
      summary: User login
      description: Authenticate user and create session. Returns session cookie.
      operationId: login
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                  example: "admin"
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: "admin123"
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              schema:
                type: string
                example: "JSESSIONID=abc123; Path=/; HttpOnly; Secure; SameSite=Strict"
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    example: "admin"
                  sessionId:
                    type: string
                    example: "abc123"
        '400':
          description: Missing credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
            X-RateLimit-Remaining:
              schema:
                type: integer
            X-RateLimit-Reset:
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      tags:
        - Auth
      summary: User registration
      description: Create new user account
      operationId: register
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                  pattern: "^[a-zA-Z0-9_]+$"
                  example: "newuser"
                password:
                  type: string
                  format: password
                  minLength: 8
                  pattern: "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$"
                  description: At least 8 characters, 1 letter and 1 number
                  example: "SecurePass123"
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                  sessionId:
                    type: string
                  message:
                    type: string
                    example: "Registration successful"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /auth/me:
    get:
      tags:
        - Auth
      summary: Get current user
      description: Returns authenticated user information from session
      operationId: getCurrentUser
      responses:
        '200':
          description: User info
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Auth
      summary: User logout
      description: Invalidate current session
      operationId: logout
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out"

  /auth/password/forgot:
    post:
      tags:
        - Auth
      summary: Request password reset
      description: |
        Send password reset email with secure token.
        
        **Security Note:** Always returns same message whether email exists or not
        to prevent email enumeration attacks.
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        '200':
          description: Reset email processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: Invalid email format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /auth/password/validate:
    get:
      tags:
        - Auth
      summary: Validate reset token
      description: Check if password reset token is valid and not expired (tokens expire after 1 hour)
      operationId: validateToken
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Password reset token from email
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Token validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/password/reset:
    post:
      tags:
        - Auth
      summary: Reset password
      description: Set new password using reset token
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                  format: uuid
                  description: Reset token from email
                  example: "123e4567-e89b-12d3-a456-426614174000"
                newPassword:
                  type: string
                  format: password
                  minLength: 6
                  description: New password (minimum 6 characters)
                  example: "NewSecurePass123"
      responses:
        '200':
          description: Password successfully changed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: Invalid token or password requirements
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /auth/password/reset-form:
    post:
      tags:
        - Auth
      summary: Reset password (form)
      description: Form-based password reset for web clients (HTML forms)
      operationId: resetPasswordForm
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                  format: uuid
                  example: "123e4567-e89b-12d3-a456-426614174000"
                newPassword:
                  type: string
                  format: password
                  minLength: 6
                  example: "NewSecurePass123"
      responses:
        '200':
          description: Password successfully changed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reminder/record:
    post:
      tags:
        - Reminders
      summary: Record voice reminder
      description: |
        Upload audio file for voice reminder processing.
        
        **Async Processing Flow:**
        1. Audio uploaded and stored temporarily
        2. Transcription job started (AWS Transcribe)
        3. NLP service extracts intent and entities
        4. Reminder saved to OpenSearch
        5. EventBridge rule created for scheduling
        6. Email notification sent at scheduled time
        
        **Note:** Returns immediately with `processing` status. Full processing takes 5-30 seconds.
      operationId: recordReminder
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - userId
                - userEmail
                - audio
              properties:
                userId:
                  type: string
                  description: User identifier (from auth)
                  example: "user123"
                userEmail:
                  type: string
                  format: email
                  description: Email for notification delivery
                  example: "user@example.com"
                audio:
                  type: string
                  format: binary
                  description: |
                    Audio file with voice reminder
                    
                    **Supported formats:** WAV, MP3, FLAC, M4A
                    **Max size:** 10MB
                    **Max duration:** 30 seconds
                    **Language:** Russian (ru-RU)
      responses:
        '200':
          description: Reminder accepted for async processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminderId:
                    type: string
                    format: uuid
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  userId:
                    type: string
                    example: "user123"
                  userEmail:
                    type: string
                    example: "user@example.com"
                  status:
                    type: string
                    enum: [processing]
                    example: "processing"
                  message:
                    type: string
                    example: "Reminder is being processed"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2026-02-19T10:30:00Z"
        '400':
          description: Missing required fields or invalid audio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: Audio file too large (max 10MB)
        '415':
          description: Unsupported audio format
        '429':
          $ref: '#/components/responses/RateLimit'
        '500':
          description: Processing error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reminder/{id}:
    get:
      tags:
        - Reminders
      summary: Get reminder details
      description: Retrieve full reminder information including NLP results and processing status
      operationId: getReminder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Reminder ID
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Reminder found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReminderRecord'
        '404':
          description: Reminder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

    delete:
      tags:
        - Reminders
      summary: Delete reminder
      description: |
        Remove reminder and associated resources:
        - Delete from OpenSearch
        - Remove EventBridge rule
        - Clean up any temporary files
      operationId: deleteReminder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Reminder ID to delete
      responses:
        '200':
          description: Reminder deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminderId:
                    type: string
                    format: uuid
                  deleted:
                    type: boolean
                    example: true
                  timestamp:
                    type: string
                    format: date-time
        '404':
          description: Reminder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /reminder/{id}/transcription:
    get:
      tags:
        - Reminders
      summary: Get reminder transcription
      description: |
        Retrieve the transcribed text from original audio.
        
        Returns either:
        - Full transcription from AWS Transcribe (if available)
        - Original text from reminder (as fallback)
      operationId: getTranscription
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Reminder ID
      responses:
        '200':
          description: Transcription found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranscriptionResult'
        '404':
          description: Reminder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /user/{userId}/reminders:
    get:
      tags:
        - Reminders
      summary: List user reminders
      description: Get paginated list of user's reminders with optional status filter
      operationId: getUserReminders
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
          description: User ID
          example: "user123"
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Number of reminders to return
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, SCHEDULED, TRIGGERED, CANCELLED, FAILED, COMPLETED]
          description: Filter by reminder status
          example: "SCHEDULED"
      responses:
        '200':
          description: List of reminders
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  total:
                    type: integer
                    description: Total reminders matching filter
                  filtered:
                    type: integer
                    description: Number after status filtering
                  reminders:
                    type: array
                    items:
                      type: object
                      properties:
                        reminderId:
                          type: string
                          format: uuid
                        extractedAction:
                          type: string
                          example: "купить молоко"
                        scheduledTime:
                          type: string
                          format: date-time
                        reminderTime:
                          type: string
                          example: "09:00"
                        status:
                          type: string
                          enum: [PENDING, SCHEDULED, TRIGGERED, CANCELLED, FAILED, COMPLETED]
                        createdAt:
                          type: string
                          format: date-time
                        notificationSent:
                          type: boolean
                  timestamp:
                    type: string
                    format: date-time
        '429':
          $ref: '#/components/responses/RateLimit'

  /autocomplete:
    get:
      tags:
        - Search
      summary: Autocomplete reminders
      description: |
        Search-as-you-type suggestion for user's reminders.
        
        **Features:**
        - Fuzzy matching for typos
        - Context-aware suggestions
        - Real-time performance via OpenSearch completion suggester
        
        **Example queries:**
        - `купи` → "купить молоко", "купить хлеб"
        - `встреч` → "встреча с командой", "встреча в 15:00"
        - `позвон` → "позвонить маме", "позвонить в банк"
      operationId: autocompleteReminders
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
          description: User ID
          example: "user123"
        - name: query
          in: query
          required: true
          schema:
            type: string
            minLength: 2
            maxLength: 50
          description: Partial search query (minimum 2 characters)
          example: "купи"
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
            minimum: 1
            maximum: 20
          description: Maximum number of suggestions
      responses:
        '200':
          description: Autocomplete suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutocompleteResponse'
        '400':
          description: Missing required parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /stats/{userId}:
    get:
      tags:
        - Stats
      summary: Get user statistics
      description: |
        Retrieve analytics and statistics for user reminders.
        
        **Metrics included:**
        - Total reminders count
        - Distribution by status
        - Daily/weekly trends
        - Most common intents
        - Average processing time
        
        **Use cases:**
        - User dashboard
        - Usage analytics
        - Performance monitoring
      operationId: getUserStats
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
          description: User ID
          example: "user123"
      responses:
        '200':
          description: User statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  stats:
                    $ref: '#/components/schemas/ReminderStats'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          $ref: '#/components/responses/RateLimit'

  /test:
    get:
      tags:
        - Health
      summary: Health check
      description: Simple endpoint to verify API is working (no authentication required)
      operationId: test
      responses:
        '200':
          description: API is healthy
          content:
            text/plain:
              schema:
                type: string
                example: "API is working!"

  /metrics:
    get:
      tags:
        - Metrics
      summary: Prometheus metrics
      description: |
        Get Prometheus-formatted metrics for monitoring and alerting.
        
        **Available metrics:**
        - JVM memory usage (heap/non-heap)
        - HTTP request counters by endpoint/status
        - Rate limit hits and remaining
        - Processing durations (transcribe, NLP, search)
        - SQS queue depths
        - OpenSearch query latencies
        - Active sessions count
        - Error rates by type
        
        **Format:** Prometheus exposition format (text/plain)
        
        **Intended for:** Prometheus scraper, not human consumption
      operationId: getMetrics
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string
                example: |
                  # HELP jvm_memory_used_bytes Used bytes of a given JVM memory area.
                  # TYPE jvm_memory_used_bytes gauge
                  jvm_memory_used_bytes{area="heap"} 1.2345678E8
                  # HELP http_requests_total Total HTTP requests
                  # TYPE http_requests_total counter
                  http_requests_total{endpoint="/auth/login",status="200"} 42.0
        '408':
          description: Metrics scraping timeout (10s limit)
          content:
            text/plain:
              schema:
                type: string
                example: "Metrics scraping timeout"
        '500':
          description: Error scraping metrics
          content:
            text/plain:
              schema:
                type: string
                example: "Error scraping metrics: OpenSearch connection failed"

components:
  schemas:
    ReminderRecord:
      type: object
      description: Full reminder record with all metadata from OpenSearch
      properties:
        reminderId:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        userId:
          type: string
          example: "user123"
        originalText:
          type: string
          description: Raw transcribed text from audio
          example: "Напомни купить молоко завтра в 9 утра"
        extractedAction:
          type: string
          description: Normalized action text
          example: "купить молоко"
        scheduledTime:
          type: string
          format: date-time
          description: Parsed date and time for reminder
          example: "2026-02-20T09:00:00Z"
        reminderTime:
          type: string
          pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
          description: Extracted time in HH:mm format
          example: "09:00"
        createdAt:
          type: string
          format: date-time
          description: When reminder was created
          example: "2026-02-19T22:35:00Z"
        status:
          type: string
          enum: [PENDING, SCHEDULED, TRIGGERED, CANCELLED, FAILED, COMPLETED]
          description: |
            - PENDING: Audio uploaded, processing not started
            - SCHEDULED: Fully processed, waiting for trigger time
            - TRIGGERED: Reminder time reached, notification sent
            - COMPLETED: User acknowledged/completed
            - CANCELLED: User cancelled before trigger
            - FAILED: Processing error
          example: "SCHEDULED"
        notificationSent:
          type: boolean
          description: Whether email notification was sent
          example: false
        intent:
          type: string
          enum: [create_reminder, cancel_reminder, check_reminders, unknown]
          description: NLP-detected user intent
          example: "create_reminder"
        eventBridgeRuleName:
          type: string
          description: AWS EventBridge rule name for scheduling
          example: "reminder-123e4567-rule"
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: NLP processing confidence
          example: 0.95
      required:
        - reminderId
        - userId
        - status
        - createdAt

    TranscriptionResult:
      type: object
      description: Result of AWS Transcribe job with audio metadata
      properties:
        transcriptionId:
          type: string
          description: AWS Transcribe job ID
          example: "transcribe-job-123"
        originalAudioKey:
          type: string
          description: S3 key of original audio
          example: "audio/user123/recording.wav"
        transcribedText:
          type: string
          description: Transcribed text in Russian
          example: "напомни купить молоко завтра в девять утра"
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Transcription confidence score
          example: 0.95
        language:
          type: string
          description: Detected language code
          example: "ru-RU"
        durationSeconds:
          type: number
          description: Audio duration in seconds
          example: 3.5
        completedAt:
          type: string
          format: date-time
          description: When transcription completed
          example: "2026-02-19T10:30:05Z"
      required:
        - transcriptionId
        - transcribedText

    PasswordResetResponse:
      type: object
      description: Password reset operation response
      properties:
        success:
          type: boolean
          description: Operation success status
          example: true
        message:
          type: string
          description: User-friendly message
          example: "If the email exists, reset instructions will be sent"
        token:
          type: string
          nullable: true
          description: Token value (only returned for validate endpoint)
          example: null
      required:
        - success
        - message

    AutocompleteResponse:
      type: object
      description: Autocomplete search results with suggestions
      properties:
        userId:
          type: string
          example: "user123"
        query:
          type: string
          example: "купи"
        total:
          type: integer
          description: Total number of suggestions found
          example: 3
        suggestions:
          type: array
          description: List of autocomplete suggestions
          items:
            $ref: '#/components/schemas/AutocompleteSuggestion'
        timestamp:
          type: string
          format: date-time
          example: "2026-02-19T10:30:00Z"
      required:
        - userId
        - query
        - suggestions
        - timestamp

    AutocompleteSuggestion:
      type: object
      description: Individual autocomplete suggestion item
      properties:
        reminderId:
          type: string
          format: uuid
          description: Original reminder ID
          example: "123e4567-e89b-12d3-a456-426614174000"
        action:
          type: string
          description: Extracted action text
          example: "купить молоко"
        text:
          type: string
          description: Full suggestion text
          example: "купить молоко завтра"
        score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Relevance score (higher is better)
          example: 0.95
      required:
        - reminderId
        - text
        - score

    ParsedResult:
      type: object
      description: NLP parsing result with extracted entities and intent
      properties:
        scheduledTime:
          type: string
          format: date-time
          description: Parsed reminder time
          example: "2026-02-20T09:00:00Z"
        action:
          type: string
          description: Extracted action
          example: "купить молоко"
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Overall parsing confidence
          example: 0.92
        language:
          type: string
          description: Detected language
          example: "ru"
        reminderId:
          type: string
          format: uuid
          description: Associated reminder ID
        intent:
          type: string
          enum: [create_reminder, cancel_reminder, check_reminders, unknown]
          description: Detected user intent
          example: "create_reminder"
        entities:
          type: array
          description: Extracted named entities
          items:
            $ref: '#/components/schemas/Entity'
        rawText:
          type: string
          description: Original input text
          example: "Напомни купить молоко завтра в 9 утра"
        normalizedText:
          type: string
          description: Normalized version of text
          example: "напомни купить молоко завтра в девять утра"

    Entity:
      type: object
      description: Named entity extracted from text with position
      properties:
        text:
          type: string
          description: Entity text
          example: "завтра"
        type:
          type: string
          enum: [DATE, TIME, ACTION, PERSON, LOCATION, PRODUCT]
          description: Entity type
          example: "DATE"
        start:
          type: integer
          minimum: 0
          description: Start character index in original text
          example: 15
        end:
          type: integer
          minimum: 0
          description: End character index in original text
          example: 21
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Entity recognition confidence
          example: 0.98
      required:
        - text
        - type

    ReminderStats:
      type: object
      description: Comprehensive user reminder statistics
      properties:
        total_reminders:
          type: integer
          description: Total reminders created
          example: 42
        pending_reminders:
          type: integer
          description: Reminders pending processing
          example: 2
        scheduled_reminders:
          type: integer
          description: Scheduled future reminders
          example: 15
        triggered_reminders:
          type: integer
          description: Reminders that have triggered
          example: 20
        cancelled_reminders:
          type: integer
          description: Cancelled reminders
          example: 3
        failed_reminders:
          type: integer
          description: Failed processing attempts
          example: 2
        avg_processing_time_ms:
          type: integer
          description: Average processing time in milliseconds
          example: 1250
        last_7_days_count:
          type: integer
          description: Reminders created in last 7 days
          example: 12
        most_common_intent:
          type: string
          description: Most frequent intent type
          example: "create_reminder"
        reminders_by_status:
          type: object
          description: Breakdown by status
          additionalProperties:
            type: integer
          example:
            PENDING: 2
            SCHEDULED: 15
            TRIGGERED: 18
            COMPLETED: 2
            CANCELLED: 3
            FAILED: 2
        reminders_by_day:
          type: array
          description: Daily reminder counts for last 30 days
          items:
            type: object
            properties:
              date:
                type: string
                format: date
                example: "2026-02-19"
              count:
                type: integer
                example: 5
      required:
        - total_reminders

    ErrorResponse:
      type: object
      description: Standard error response for all endpoints
      properties:
        error:
          type: string
          description: Error type/code
          example: "Invalid credentials"
        message:
          type: string
          description: Human-readable error details
          example: "Username or password is incorrect"
        code:
          type: integer
          description: HTTP status code
          example: 401
        timestamp:
          type: string
          format: date-time
          description: When error occurred
          example: "2026-02-19T10:30:00Z"
      required:
        - error
        - message

  responses:
    RateLimit:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Maximum requests per window
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Remaining requests in current window
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Seconds until window resets
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Too Many Requests"
            message: "Rate limit exceeded. Try again in 30 seconds"
            code: 429
            timestamp: "2026-02-19T10:30:00Z"

  securitySchemes:
    SessionCookie:
      type: apiKey
      in: cookie
      name: JSESSIONID
      description: |
        Session-based authentication (automatically set after login).
        
        **Cookie attributes:**
        - HttpOnly (not accessible via JavaScript)
        - Secure (HTTPS only)
        - SameSite=Strict (CSRF protection)
        - Path=/
    ApiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        Alternative API key authentication for machine clients.
        
        **Rate limits:** Higher limits for API key clients
        **Usage:** Include in all requests as header

security:
  - SessionCookie: []
  - ApiKey: []

x-amazon-apigateway-auth:
  type: aws_iam

x-amazon-apigateway-gateway-responses:
  UNAUTHORIZED:
    statusCode: 401
    responseTemplates:
      application/json: '{"error": "Unauthorized", "message": "Authentication required", "code": 401, "timestamp": "$context.requestTime"}'
  RATE_LIMIT_EXCEEDED:
    statusCode: 429
    responseTemplates:
      application/json: '{"error": "Too Many Requests", "message": "Rate limit exceeded. Please slow down.", "code": 429, "timestamp": "$context.requestTime"}'
  DEFAULT_4XX:
    statusCode: 400
    responseTemplates:
      application/json: '{"error": "Bad Request", "message": "$context.error.message", "code": 400, "timestamp": "$context.requestTime"}'
  DEFAULT_5XX:
    statusCode: 500
    responseTemplates:
      application/json: '{"error": "Internal Server Error", "message": "An unexpected error occurred", "code": 500, "timestamp": "$context.requestTime"}'

x-api-id: voice-reminder-api-v2
x-rate-limits:
  default: 100/minute
  authenticated: 1000/minute
  premium: 10000/minute